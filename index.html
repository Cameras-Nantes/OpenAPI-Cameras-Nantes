<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Cameras of Nantes</title>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

		<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

		<link rel="stylesheet" type="text/css" href="css/960_12_col.css">

		<style type="text/css">
			body{
				padding-top:70px; 
			}
			#location{
				width: 300px;
			}
			#formSearch{
				padding-left: 100px;
			}
		</style>
	</head>
	<body ng-app="myApp">

		<nav class="navbar navbar-dark bg-inverse navbar-fixed-top">
				<a class="navbar-brand" href="#">OpenData-Camera-Nantes</a>
				<ul class="nav navbar-nav">
					<li class="nav-item active">
						<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
					</li>
				</ul>

				<form class="form-inline pull-xs-right" id="formSearch">
					<div class="input-group">
						<div class="input-group-btn">
							<button type="button" class="btn btn-secondary">Rechercher par lieu</button>
						</div>
						<input type="text" class="form-control" placeholder="Ex: Pirmil" id="location">
						<div class="input-group-btn">
							<button type="submit" class="btn btn-success-outline">Go</button>
						</div>
					</div>
				</form>

				<ul class="nav navbar-nav pull-xs-right">
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							Rechercher par n° de caméra
						</a>
						<div class="dropdown-menu" aria-labelledby="Preview">
							<a class="dropdown-item" href="#">Dropdown Link 1</a>
							<a class="dropdown-item" href="#">Dropdown Link 2</a>
							<a class="dropdown-item" href="#">Dropdown Link 3</a>
						</div>
					</li>
				</ul>
			</nav>

		<div class="container">
			<h1>Centralisation des caméras de <a href="http://infotrafic.nantesmetropole.fr/carto.html">Nantes Metropole Info Trafic</a></h1> 

			<div ui-view> 
				Si vous voyez ceci, il y a un problème dans le script.
			</div> 

			<div class="container_12" id="imgs">
		
			</div>	
			
		</div>

		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.1.5/angular.min.js"></script> 
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.3.0/angular-ui-router.js"></script> 
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/restangular/1.3.1/restangular.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.13.1/lodash.min.js"></script> 
		<script type="text/javascript">
			_.contains = _.includes;

			angular.module('myApp', ['ui.router', 'restangular']).config(function($stateProvider, $urlRouterProvider, RestangularProvider) {

				RestangularProvider.setBaseUrl('http://project-file-share-1.firebaseio.com/');

				/*
				 * You need to add the suffix ".json" at the URL to retrieve JSON flow from firebase 
				 */
				RestangularProvider.setRequestSuffix('.json');

				// Initialisation du format de sortie
				RestangularProvider.setDefaultHeaders({'Content-Type' : 'application/json'});


				/*
			 * See https://project-file-share-1.firebaseio.com/helloworld.json to view the structure of the response
			 */
			RestangularProvider.setResponseExtractor(function(response, operation) {
				console.log(response.urls);
				return response.urls;
			});

				// Url par défaut
				$urlRouterProvider.otherwise("/data");

				$stateProvider.state('data', {
					url: '/data',
					template: '<div ui-view></div>',
					resolve: {
						respRest : function(Restangular) {
							try {
								var urls = Restangular.one("data-cameras-urls", "-KJ6BONU9P5SSNiUqJQB").get().then(function(urls) {
									var html = "<ul class='list-unstyled inline'>";
									for(var i=700; i<=799; i++) {
										/*$("#columns").append("<div class='card' id='"+i+"'>");
										
										$("#" +i).append("<img class='card-img-top' src='" + urls["s"+i] + "' alt='camera manquante' onerror='$'> <div class='card-block'>");*/

										html += "<li> <img class='card-img-top' src='" + urls["s"+i] + "' alt='notfound'> </li>";
										
									}

									$("#imgs").append(html);

									$("img").error(function() {
											$(this).parent().remove()
									});
								});  
							}
							catch(e) {
								console.log(e);
							}
						}
					}
				});
			});
		</script>
	</body>
</html>